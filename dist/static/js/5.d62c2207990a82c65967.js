webpackJsonp([5],{AXUn:function(e,t){},IXyH:function(e,t,n){"use strict";Object.defineProperty(t,"__esModule",{value:!0});var i=n("XxfO"),a=(n("Q8Xg"),n("0d4u")),o=n("xgxr"),r=n("i0Lz"),s=n("d7gU"),c=n("xds+"),l=n.n(c),d=n("C/00"),m=n("/76X"),u=n.n(m);function p(e,t,n,i,a,o,r){try{var s=e[o](r),c=s.value}catch(e){return void n(e)}s.done?t(c):Promise.resolve(c).then(i,a)}function g(e){return function(){var t=this,n=arguments;return new Promise(function(i,a){var o=e.apply(t,n);function r(e){p(o,i,a,r,s,"next",e)}function s(e){p(o,i,a,r,s,"throw",e)}r(void 0)})}}var h={name:"WorkflowBpmnModeler",components:{panel:o.a,VueAceEditor:l.a},props:{xml:{type:String,default:""},users:{type:Array,default:function(){return[]}},groups:{type:Array,default:function(){return[]}},categorys:{type:Array,default:function(){return[]}},isView:{type:Boolean,default:!1}},data:function(){return{nodeName:"",process:{xml:""},xmlVisible:!1,modeler:null,taskList:[],zoom:1,nodeList:[]}},watch:{xml:function(e){e&&this.createNewDiagram(e)}},mounted:function(){this.modeler=new d.a({container:this.$refs.canvas,keyboard:{bindTo:window},bpmnRenderer:{defaultStrokeColor:"#fff"},additionalModules:[{translate:["value",a.a],zoomScroll:["type",function(){return!1}]}],moddleExtensions:{camunda:u.a}}),this.xml?this.createNewDiagram(this.xml):this.newDiagram(),this.addBpmnListener();var e=navigator.userAgent.indexOf("Firefox")>-1,t=window.addEventListener?function(e,t,n,i){e.addEventListener(t,n,i)}:window.attachEvent?function(e,t,n,i){e.attachEvent("on"+t,n)}:function(){},n=e?"DOMMouseScroll":"mousewheel";t(this.$refs.canvas,n,function(e){var t=e||window.event;e.preventDefault(),function(e){e.stopPropagation?e.stopPropagation():e.cancelBubble=!0,e.preventDefault?e.preventDefault():e.returnValue=!1}(t)},!1)},methods:{handleRedo:function(){this.modeler.get("commandStack").redo()},handleUndo:function(){this.modeler.get("commandStack").undo()},onCopy:function(){this.$message({message:"复制成功",type:"success"})},addBpmnListener:function(){var e=this;this.modeler.on("commandStack.changed",function(){e.saveDiagram(function(t,n){var i=e.$getsessionStorage("processId");e.$emit("getNewXMLInFo",{xml:n,name:i})})})},saveDiagram:function(e){var t=this;return g(regeneratorRuntime.mark(function n(){var i,a,o;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return n.next=2,t.modeler.saveXML({format:!0});case 2:i=n.sent,a=i.err,o=i.xml,e(a,o);case 6:case"end":return n.stop()}},n)}))()},editorInit:function(){n("aDfU"),n("kum0"),n("KFFf")},newDiagram:function(){this.createNewDiagram(Object(s.a)())},fitViewport:function(){this.zoom=this.modeler.get("canvas").zoom("fit-viewport");var e=document.querySelector(".flow-containers .viewport").getBBox(),t=this.modeler.get("canvas").viewbox(),n=e.x+e.width/2-65,i=e.y+e.height/2;this.modeler.get("canvas").viewbox({x:n-t.width/2,y:i-t.height/2,width:t.width,height:t.height}),this.zoom=e.width/t.width*1.8},zoomViewport:function(){var e=!(arguments.length>0&&void 0!==arguments[0])||arguments[0];this.zoom=this.modeler.get("canvas").zoom(),this.zoom+=e?.1:-.1,this.modeler.get("canvas").zoom(this.zoom)},createNewDiagram:function(e){var t=this;return g(regeneratorRuntime.mark(function n(){return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return e=e.replace(/<!\[CDATA\[(.+)]]>/g,"&lt;![CDATA[$1]]&gt;"),n.prev=1,n.next=4,t.modeler.importXML(e);case 4:t.adjustPalette(),t.fitViewport(),n.next=11;break;case 8:n.prev=8,n.t0=n.catch(1);case 11:case"end":return n.stop()}},n,null,[[1,8]])}))()},addOverLay:function(e){var t=this.modeler.get("elementRegistry");this.nodeList=t.filter(function(e){return"bpmn:UserTask"===e.type||"bpmn:Task"===e.type});var n=this.modeler.get("overlays"),i=t.get(e);if(i){var a=$('<div class="highlight-overlay"></div>').css({width:i.width,height:i.height,background:"red"});n.add(e,{position:{top:0,left:0},html:a})}this.overlayClick()},overlayClick:function(){var e=this;$(".djs-container").on("click",".djs-overlays",function(t){var n=t.target.parentElement.parentElement.getAttribute("data-container-id"),i=e.nodeList.filter(function(e){return e.id===n})[0];e.nodeName=i?i.businessObject.name:""})},addEventBusListener:function(){var e=this;this.modeler.get("eventBus").on("element.click",function(t){var n=t.element;if(n.parent)return!(!t||"bpmn:Process"===n.type)&&void(e.nodeName=n.businessObject.name)})},adjustPalette:function(){$(".bjs-powered-by").css("display","none");try{var e=this.$refs.canvas.children[0].children[1].children[4],t={width:"100px",padding:"5px",left:"20px",borderRadius:0};for(var n in t)e.style[n]=t[n];var i=e.children[0].children;for(var a in i[0].style.display="none",i){var o=i[a];for(var s in o.children){var c=o.children[s],l={display:"flex",justifyContent:"center",alignItems:"center",width:"100%",boxSizing:"border-box",padding:"5px"};if(c.className&&c.dataset&&-1!==c.className.indexOf("entry")){var d=(new r.a).getControl(c.dataset.action);for(var m in c.innerHTML='<div style="width:30px;height:30px;" class="'+d.icon+'"></div><div class="tool-text" style="font-size: 14px;font-weight:500;margin-left:10px;">'+d.title+"</div>",l)c.style[m]=l[m]}}}}catch(e){}},fillColor:function(){var e=this,t=this.modeler.get("canvas");this.modeler._definitions.rootElements[0].flowElements.forEach(function(n){if("bpmn:UserTask"===n.$type){var i,a=e.taskList.find(function(e){return e.key===n.id})||{completed:!0},o=e.taskList.find(function(e){return!e.completed}),r=e.taskList[e.taskList.length-1];if(a)t.addMarker(n.id,a.completed?"highlight":"highlight-todo"),null===(i=n.outgoing)||void 0===i||i.forEach(function(i){var s=e.taskList.find(function(e){return e.key===i.targetRef.id});s?t.addMarker(i.id,s.completed?"highlight":"highlight-todo"):"bpmn:ExclusiveGateway"===i.targetRef.$type?(t.addMarker(i.id,a.completed?"highlight":"highlight-todo"),t.addMarker(i.targetRef.id,a.completed?"highlight":"highlight-todo")):"bpmn:EndEvent"===i.targetRef.$type&&(o||r.key!==n.id||(t.addMarker(i.id,"highlight"),t.addMarker(i.targetRef.id,"highlight")),a.completed||(t.addMarker(i.id,"highlight-todo"),t.addMarker(i.targetRef.id,"highlight-todo")))})}else"bpmn:ExclusiveGateway"===n.$type&&n.outgoing.forEach(function(n){var i=e.taskList.find(function(e){return e.key===n.targetRef.id});i&&t.addMarker(n.id,i.completed?"highlight":"highlight-todo")});"bpmn:StartEvent"===n.$type&&n.outgoing.forEach(function(i){if(e.taskList.find(function(e){return e.key===i.targetRef.id}))return t.addMarker(i.id,"highlight"),void t.addMarker(n.id,"highlight")})})},getProcess:function(){var e=this.getProcessElement();return{id:e.id,name:e.name,category:e.$attrs["camunda:processCategory"]}},getProcessElement:function(){return this.modeler.getDefinitions().rootElements[0]},saveXML:function(){var e=arguments,t=this;return g(regeneratorRuntime.mark(function n(){var i,a,o;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return i=e.length>0&&void 0!==e[0]&&e[0],n.prev=1,n.next=4,t.modeler.saveXML({format:!0});case 4:return a=n.sent,o=(o=(o=a.xml).replace(/&lt;/g,"<")).replace(/&gt;/g,">"),i&&t.downloadFile("".concat(t.getProcessElement().name,".bpmn20.xml"),o,"application/xml"),n.abrupt("return",o);case 12:n.prev=12,n.t0=n.catch(1);case 15:case"end":return n.stop()}},n,null,[[1,12]])}))()},saveImg:function(){var e=arguments,t=this;return g(regeneratorRuntime.mark(function n(){var i,a,o;return regeneratorRuntime.wrap(function(n){for(;;)switch(n.prev=n.next){case 0:return e.length>0&&void 0!==e[0]?e[0]:"svg",i=e.length>1&&void 0!==e[1]&&e[1],n.prev=2,n.next=5,t.modeler.saveSVG({format:!0});case 5:return a=n.sent,o=a.svg,i&&t.downloadFile(t.getProcessElement().name,o,"image/svg+xml"),n.abrupt("return",o);case 11:n.prev=11,n.t0=n.catch(2);case 14:case"end":return n.stop()}},n,null,[[2,11]])}))()},save:function(){var e=this;return g(regeneratorRuntime.mark(function t(){var n,i,a,o;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return n=e.getProcess(),t.next=3,e.saveXML();case 3:return i=t.sent,t.next=6,e.saveImg();case 6:a=t.sent,o={process:n,xml:i,svg:a},e.$emit("save",o),window.parent.postMessage(o,"*");case 11:case"end":return t.stop()}},t)}))()},preView:function(){var e=this;return g(regeneratorRuntime.mark(function t(){var n;return regeneratorRuntime.wrap(function(t){for(;;)switch(t.prev=t.next){case 0:return e.xmlVisible=!0,t.next=3,e.saveXML();case 3:n=t.sent,e.process.xml=n;case 5:case"end":return t.stop()}},t)}))()},openBpmn:function(e){var t=this,n=new FileReader;return n.readAsText(e,"utf-8"),n.onload=function(){t.createNewDiagram(n.result)},!1},downloadFile:function(e,t,n){var i=document.createElement("a"),a=window.URL.createObjectURL(new Blob([t],{type:n}));i.href=a,i.download=e,i.click(),window.URL.revokeObjectURL(a)}}},f={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.isView,expression:"isView"}],staticClass:"flow-containers",class:{"view-mode":e.isView}},[n("el-container",{staticStyle:{height:"100%"}},[n("el-header",{staticStyle:{"border-bottom":"1px solid #00e9ff",height:"auto"}},[n("div",{staticStyle:{display:"flex",padding:"10px 0px","justify-content":"space-between"}},[n("div",[n("el-upload",{staticStyle:{"margin-right":"10px",display:"inline-block"},attrs:{action:"","before-upload":e.openBpmn}},[n("el-tooltip",{attrs:{effect:"dark",content:"加载xml",placement:"bottom"}},[n("el-button",{attrs:{size:"mini",icon:"el-icon-folder-opened"}})],1)],1),e._v(" "),n("el-tooltip",{attrs:{effect:"dark",content:"新建",placement:"bottom"}},[n("el-button",{attrs:{size:"mini",icon:"el-icon-circle-plus"},on:{click:e.newDiagram}})],1),e._v(" "),n("el-tooltip",{attrs:{effect:"dark",content:"自适应屏幕",placement:"bottom"}},[n("el-button",{attrs:{size:"mini",icon:"el-icon-rank"},on:{click:e.fitViewport}})],1),e._v(" "),n("el-tooltip",{attrs:{effect:"dark",content:"放大",placement:"bottom"}},[n("el-button",{attrs:{size:"mini",icon:"el-icon-zoom-in"},on:{click:function(t){return e.zoomViewport(!0)}}})],1),e._v(" "),n("el-tooltip",{attrs:{effect:"dark",content:"缩小",placement:"bottom"}},[n("el-button",{attrs:{size:"mini",icon:"el-icon-zoom-out"},on:{click:function(t){return e.zoomViewport(!1)}}})],1),e._v(" "),n("el-tooltip",{attrs:{effect:"dark",content:"预览",placement:"bottom"}},[n("el-button",{attrs:{size:"mini",icon:"el-icon-view"},on:{click:e.preView}})],1),e._v(" "),n("el-tooltip",{attrs:{effect:"dark",content:"后退",placement:"bottom"}},[n("el-button",{attrs:{size:"mini",icon:"el-icon-back"},on:{click:e.handleUndo}})],1),e._v(" "),n("el-tooltip",{attrs:{effect:"dark",content:"前进",placement:"bottom"}},[n("el-button",{attrs:{size:"mini",icon:"el-icon-right"},on:{click:e.handleRedo}})],1)],1),e._v(" "),n("div",[n("el-button",{attrs:{size:"mini",icon:"el-icon-download"},on:{click:function(t){return e.saveXML(!0)}}},[e._v("下载xml")]),e._v(" "),n("el-button",{attrs:{size:"mini",icon:"el-icon-picture"},on:{click:function(t){return e.saveImg("svg",!0)}}},[e._v("下载svg")])],1)])]),e._v(" "),n("el-container",{staticClass:"cav-container",staticStyle:{"align-items":"stretch"}},[n("el-main",{staticStyle:{padding:"0"},on:{mousewheel:function(e){e.preventDefault()}}},[n("div",{ref:"canvas",staticClass:"canvas"})]),e._v(" "),n("el-aside",{staticClass:"panel-wrapper"},[e.modeler?n("panel",{attrs:{modeler:e.modeler,users:e.users,groups:e.groups,categorys:e.categorys}}):e._e()],1)],1)],1),e._v(" "),n("el-dialog",{attrs:{visible:e.xmlVisible,title:"XML",fullscreen:!1,top:"10vh"},on:{"update:visible":function(t){e.xmlVisible=t}}},[n("vue-ace-editor",{attrs:{lang:"xml",theme:"chrome",width:"100%",height:"400",options:{wrap:!0,readOnly:!0}},on:{init:e.editorInit},model:{value:e.process.xml,callback:function(t){e.$set(e.process,"xml",t)},expression:"process.xml"}}),e._v(" "),n("span",{staticClass:"dialog-footer",attrs:{slot:"footer"},slot:"footer"},[n("el-button",{directives:[{name:"clipboard",rawName:"v-clipboard:copy",value:e.process.xml,expression:"process.xml",arg:"copy"},{name:"clipboard",rawName:"v-clipboard:success",value:e.onCopy,expression:"onCopy",arg:"success"}],attrs:{icon:"el-icon-document"}},[e._v("复 制")]),e._v(" "),n("el-button",{attrs:{icon:"el-icon-close",type:"primary"},on:{click:function(t){e.xmlVisible=!1}}},[e._v("关闭")])],1)],1)],1)},staticRenderFns:[]};var v=n("C7Lr")(h,f,!1,function(e){n("AXUn")},null,null).exports;v.install=function(e){return e.component(v.name,v)};var w={name:"work_config",components:{bpmnModeler:v},data:function(){return{loading:!1,activeStep:0,formData:{name:"",xml:""},xml:"",users:[{name:"张三",id:"zhangsan"},{name:"李四",id:"lisi"},{name:"王五",id:"wangwu"}],groups:[{name:"web组",id:"web"},{name:"java组",id:"java"},{name:"python组",id:"python"}],categorys:[{name:"OA",id:"oa"},{name:"财务",id:"finance"}]}},mounted:function(){this.$route.query.id,this.getModelDetail()},computed:{},methods:{getNewXMLInFo:function(e){var t=e.xml,n=e.name;this.formData.xml=t,this.formData.name=n},cancel:function(){this.$router.push("/home/work_template")},goBack:function(){this.$router.push("/home/work_template/work_base?record=1")},finish:function(e){var t=this,n=this.$getsessionStorage("baseForm");n.status=e,n.xml=this.formData.xml,n.xmlName=this.formData.name;var a={queryData:{},paramsData:n};Object(i.p)(a).then(function(e){t.$message({message:"提交成功",type:"success"}),setTimeout(function(){t.cancel()},1500)}).catch(function(e){})},getModelDetail:function(){var e,t=this.$getsessionStorage("baseForm");t.xml?this.xml=t.xml:this.xml='<?xml version="1.0" encoding="UTF-8"?>\n<definitions xmlns="http://www.omg.org/spec/BPMN/20100524/MODEL" xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance" xmlns:bpmndi="http://www.omg.org/spec/BPMN/20100524/DI" xmlns:omgdc="http://www.omg.org/spec/DD/20100524/DC" xmlns:camunda="http://camunda.org/schema/1.0/bpmn" xmlns:di="http://www.omg.org/spec/DD/20100524/DI" xmlns:xsd="http://www.w3.org/2001/XMLSchema" xmlns:flowable="http://flowable.org/bpmn" targetNamespace="http://www.flowable.org/processdef">\n  <process name="name_ep6b22mi" isExecutable="true">\n    <startEvent id="Event_0gly3pi" name="开始">\n      <outgoing>Flow_0ntqzcl</outgoing>\n    </startEvent>\n    <serviceTask id="Activity_1x82dil" name="自动" camunda:class="com.boot.base.common.util.workflow.CallExternalSystemDelegate" camunda:taskType="3" camunda:warn="" camunda:usersName="[]">\n      <documentation>{"id":"Activity_1x82dil","type":3,"des":"","warn":[]}</documentation>\n      <incoming>Flow_0ntqzcl</incoming>\n    </serviceTask>\n    <sequenceFlow id="Flow_0ntqzcl" sourceRef="Event_0gly3pi" targetRef="Activity_1x82dil" />\n    <group id="Group_0mh6p36" categoryValueRef="CategoryValue_1p7sxin" />\n  </process>\n  <category id="Category_18p6x23">\n    <categoryValue id="CategoryValue_1p7sxin" />\n  </category>\n  <bpmndi:BPMNDiagram id="BPMNDiagram_flow">\n    <bpmndi:BPMNPlane id="BPMNPlane_flow" bpmnElement="process_1608515956102">\n      <bpmndi:BPMNEdge id="Flow_0ntqzcl_di" bpmnElement="Flow_0ntqzcl">\n        <di:waypoint x="95" y="90" />\n        <di:waypoint x="95" y="225" />\n      </bpmndi:BPMNEdge>\n      <bpmndi:BPMNShape id="Activity_1x82dil_di" bpmnElement="Activity_1x82dil">\n        <omgdc:Bounds x="45" y="225" width="100" height="50" />\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id="Event_0gly3pi_di" bpmnElement="Event_0gly3pi">\n        <omgdc:Bounds x="75" y="50" width="40" height="40" />\n        <bpmndi:BPMNLabel>\n          <omgdc:Bounds x="84" y="26" width="22" height="14" />\n        </bpmndi:BPMNLabel>\n      </bpmndi:BPMNShape>\n      <bpmndi:BPMNShape id="Group_0mh6p36_di" bpmnElement="Group_0mh6p36">\n        <omgdc:Bounds x="-70" y="-10" width="330" height="430" />\n      </bpmndi:BPMNShape>\n    </bpmndi:BPMNPlane>\n  </bpmndi:BPMNDiagram>\n</definitions>\n\n\n\n',this.formData.name=null!==(e=t.xmlName)&&void 0!==e?e:""},saveModeler:function(e){}}},x={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("div",{staticClass:"event event-wrapper add_template"},[n("div",{directives:[{name:"loading",rawName:"v-loading",value:e.loading,expression:"loading"}],staticClass:"event-content w100"},[n("div",{staticClass:"ub w100 relative"},[n("div",{staticClass:"list-tips"},[e._v("新建模板")]),e._v(" "),n("div",{staticClass:"ub",staticStyle:{"margin-left":"20px"}},[n("el-steps",{attrs:{space:100,active:e.activeStep}},[n("el-step",[n("i",{staticClass:"step1 step1Finish",attrs:{slot:"icon"},slot:"icon"},[e._v("工单基本信息")])]),e._v(" "),n("el-step",[n("i",{staticClass:"step2 step2Active",attrs:{slot:"icon"},slot:"icon"},[e._v("配置流程信息")])])],1)],1),e._v(" "),n("div",{staticClass:"btn-wrap",staticStyle:{"font-size":"0"}},[n("cancle-btn",{attrs:{title:"取 消"},on:{click:e.cancel}}),e._v(" "),n("cancle-btn",{attrs:{title:"上一步"},on:{click:e.goBack}})],1)]),e._v(" "),n("div",{staticClass:"w100 pic-wrapper",staticStyle:{color:"#fff"}},[n("bpmn-modeler",{ref:"refNode",attrs:{xml:e.xml,users:e.users,groups:e.groups,categorys:e.categorys,"is-view":!1},on:{getNewXMLInFo:e.getNewXMLInFo,save:e.saveModeler}})],1)])])},staticRenderFns:[]};var b=n("C7Lr")(w,x,!1,function(e){n("xC5w")},"data-v-120aae98",null);t.default=b.exports},xC5w:function(e,t){}});